<include file='common/meta' />
<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-form" lay-filter="layuiadmin-form-admin" style="padding: 20px 30px 1px 0;">
            <form action="" class="layui-form">
                <input type="hidden" name="id" value="{:input('id')}">


                  <div class="layui-form-item">
                     <label class="layui-form-label">所属门店</label>
                     <div class="layui-input-block">
                         <select name="goods_id" id="" lay-verify="required" lay-search  lay-filter="goods">
                             <option value="">请选择门店</option>
                             <foreach name="goods" item="vo">
                                 <option value="{$vo.id}" <if condition="$vo.id eq $list.goods_id">selected</if>>{$vo.title}</option>
                             </foreach>
                         </select>
                     </div>
                 </div>
                  <div class="layui-form-item">
                     <label class="layui-form-label">等级</label>
                     <div class="layui-input-block">
                         <select name="grade_id" id="" lay-verify="required" lay-search  lay-filter="grade">
                             <option value="">请选择等级</option>
                             <foreach name="grade" item="vo">
                                 <option value="{$vo.id}" <if condition="$vo.id eq $list.grade_id">selected</if>>{$vo.name}</option>
                             </foreach>
                         </select>
                     </div>
                 </div>

                  <div class="layui-form-item comp" <if condition="!$list"> style="display: none"</if>>
                     <label class="layui-form-label">请选择服务</label>
                     <div class="layui-input-block ajax-service">
                      <if condition="!empty($list)">
                           <foreach name="comp" item="v">
                           <input type="checkbox" name="comp_id[]" title="{$v.title}" value="{$v.id}" <if condition="in_array($v.id,$list.comp_id)">checked</if>>
                          </foreach>
                      </if>
                     </div>
                   </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">名称</label>
                    <div class="layui-input-block">
                        <input type="text" name="name" value="{$list.name}" lay-verify="required" autocomplete="off" placeholder="请输入内容" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">头像</label>
                    <div class="layui-input-block layui-upload">
                        <button type="button" class="layui-btn layui-btn-normal file" id="test1"><i class="layui-icon"></i>上传头像</button>
                        <input class="layui-upload-file" type="file" accept="undefined" name="file" id="test1s">
                        <span class="layui-inline layui-upload-choose">支持 png、jpg、jpeg 格式文件</span>
                    </div>
                     <label class="layui-form-label"></label>
                    <div style="margin-top:10px" id="video_val">
                        <img src="{$list.pic}" style="width:200px" id="img">
                    </div>
                </div>

                 <div class="layui-form-item">
                    <label class="layui-form-label">底薪</label>
                    <div class="layui-input-block">
                        <input type="text" name="price" value="{$list.price}" lay-verify="required" autocomplete="off" placeholder="请输入底薪，例：6k" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">理疗值</label>
                    <div class="layui-input-block">
                        <input type="text" name="zhi" value="{$list.zhi}" lay-verify="required" autocomplete="off" placeholder="请输入理疗值" class="layui-input">
                    </div>
                </div>

                 <div class="layui-form-item">
                    <label class="layui-form-label">手机号</label>
                    <div class="layui-input-block">
                        <input type="text" name="phone" value="{$list.phone}" lay-verify="required" autocomplete="off" placeholder="请输入手机号" class="layui-input">
                    </div>
                </div>

                 <div class="layui-form-item">
                    <label class="layui-form-label">密码</label>
                    <div class="layui-input-block">
                        <input type="password" name="password" value="{$list.password}" lay-verify="required" autocomplete="off" placeholder="请输入密码" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item ">
                    <label class="layui-form-label">入职日期</label>
                    <div class="layui-input-inline">
                        <input type="text" name="entry_day" value="{$list.entry_day}" id="start" autocomplete="off" placeholder="入职日期" class="layui-input">
                    </div>
                </div>

                <if condition="!empty($list)">
                     <div class="layui-form-item">
                        <label class="layui-form-label">基础指标/元</label>
                        <div class="layui-input-block">
                            <input type="text" name="base_money" value="{$list.base_money}" lay-verify="required" autocomplete="off" placeholder="请输入基础指标" class="layui-input">
                        </div>
                    </div>

                     <div class="layui-form-item">
                        <label class="layui-form-label">日指标/元</label>
                        <div class="layui-input-block">
                            <input type="text" name="day_money" value="{$list.day_money}" lay-verify="required" autocomplete="off" placeholder="请输入日指标" class="layui-input">
                        </div>
                    </div>

                     <div class="layui-form-item">
                        <label class="layui-form-label">周指标/元</label>
                        <div class="layui-input-block">
                            <input type="text" name="week_money" value="{$list.week_money}" lay-verify="required" autocomplete="off" placeholder="请输入周指标" class="layui-input">
                        </div>
                    </div>

                     <div class="layui-form-item">
                        <label class="layui-form-label">月指标/元</label>
                        <div class="layui-input-block">
                            <input type="text" name="month_money" value="{$list.month_money}" lay-verify="required" autocomplete="off" placeholder="请输入月指标" class="layui-input">
                        </div>
                    </div>

                     <div class="layui-form-item">
                        <label class="layui-form-label">提成比例</label>
                        <div class="layui-input-block">
                            <input type="text" name="royalty_precent" value="{$list.royalty_precent}" lay-verify="required" autocomplete="off" placeholder="请输入提成比例" class="layui-input">
                        </div>
                    </div>

                     <div class="layui-form-item">
                        <label class="layui-form-label">满意度</label>
                        <div class="layui-input-block">
                            <input type="text" name="satisfaction" value="{$list.satisfaction}" lay-verify="required" autocomplete="off" placeholder="请输入满意度" class="layui-input">
                        </div>
                    </div>

                     <div class="layui-form-item">
                        <label class="layui-form-label">工单量</label>
                        <div class="layui-input-block">
                            <input type="text" name="order_num" value="{$list.order_num}" lay-verify="required" autocomplete="off" placeholder="请输入工单量" class="layui-input">
                        </div>
                    </div>

                     <div class="layui-form-item">
                        <label class="layui-form-label">回头率</label>
                        <div class="layui-input-block">
                            <input type="text" name="return_rate" value="{$list.return_rate}" lay-verify="required" autocomplete="off" placeholder="请输入回头率" class="layui-input">
                        </div>
                    </div>




                <else />
                     <div class="layui-form-item">
                        <label class="layui-form-label">基础指标/元</label>
                        <div class="layui-input-block">
                            <input type="text" name="base_money" value="{$config.base_money}" lay-verify="required" autocomplete="off" placeholder="请输入基础指标" class="layui-input">
                        </div>
                    </div>

                     <div class="layui-form-item">
                        <label class="layui-form-label">日指标/元</label>
                        <div class="layui-input-block">
                            <input type="text" name="day_money" value="{$config.day_money}" lay-verify="required" autocomplete="off" placeholder="请输入日指标" class="layui-input">
                        </div>
                    </div>

                     <div class="layui-form-item">
                        <label class="layui-form-label">周指标/元</label>
                        <div class="layui-input-block">
                            <input type="text" name="week_money" value="{$config.week_money}" lay-verify="required" autocomplete="off" placeholder="请输入周指标" class="layui-input">
                        </div>
                    </div>

                     <div class="layui-form-item">
                        <label class="layui-form-label">月指标/元</label>
                        <div class="layui-input-block">
                            <input type="text" name="month_money" value="{$config.month_money}" lay-verify="required" autocomplete="off" placeholder="请输入月指标" class="layui-input">
                        </div>
                    </div>

                     <div class="layui-form-item">
                        <label class="layui-form-label">提成比例</label>
                        <div class="layui-input-block">
                            <input type="text" name="royalty_precent" value="{$config.royalty_precent}" lay-verify="required" autocomplete="off" placeholder="请输入提成比例" class="layui-input">
                        </div>
                    </div>

                     <div class="layui-form-item">
                        <label class="layui-form-label">满意度</label>
                        <div class="layui-input-block">
                            <input type="text" name="satisfaction" value="{$config.satisfaction}" lay-verify="required" autocomplete="off" placeholder="请输入满意度" class="layui-input">
                        </div>
                    </div>

                     <div class="layui-form-item">
                        <label class="layui-form-label">工单量</label>
                        <div class="layui-input-block">
                            <input type="text" name="order_num" value="{$config.order_num}" lay-verify="required" autocomplete="off" placeholder="请输入工单量" class="layui-input">
                        </div>
                    </div>

                     <div class="layui-form-item">
                        <label class="layui-form-label">回头率</label>
                        <div class="layui-input-block">
                            <input type="text" name="return_rate" value="{$config.return_rate}" lay-verify="required" autocomplete="off" placeholder="请输入回头率" class="layui-input">
                        </div>
                    </div>
                </if>



                <div class="layui-form-item">
                     <label class="layui-form-label">资质证书</label>
                    <a href="{$list.cert}" target="_bank" style="margin-top:10px" id="video_val">
                        <img src="{$list.cert}" style="width:200px" id="img">
                    </a>
                </div>

                <div class="layui-form-item">
                     <label class="layui-form-label">个人作品</label>
                     <volist name="$list.images" id="vo">
                      <a href="{$vo}" target="_bank" style="margin-top:10px; margin-right:10px; float:left;">
                        <img src="{$vo}" style="width:200px" id="img">
                      </a>
                    </volist>
                </div>

                <if condition="!empty($work)">
                  <volist name="work" id="vo">
                    <div style="border-top:1px dashed #666; padding-top:10px; margin-top:10px; width:45%;">
                       <div class="layui-form-item">
                          <label class="layui-form-label">单位名称</label>
                          <div class="layui-input-block">
                              <input type="text" name="title" value="{$vo.title}" lay-verify="required" autocomplete="off" placeholder="请输入单位名称" class="layui-input">
                          </div>
                       </div>

                      <div class="layui-form-item ">
                          <label class="layui-form-label">在职时间</label>
                          <div class="layui-input-inline" style="width:150px;margin-right:0">
                              <input type="text" name="start_time" value="{$vo.start_time}" id="start" autocomplete="off" placeholder="在职时间" class="layui-input" style="width:100%;">
                          </div>
                          <div class="layui-form-mid" style="margin-left:10px">至</div>
                          <div class="layui-input-inline" style="width:150px;">
                              <input type="text" name="end_time" value="{$vo.end_time}" id="end" autocomplete="off" placeholder="结束时间" class="layui-input" style="width:100%;">
                          </div>
                      </div>
                    </div>
                 </volist>
                </if>



                <input type="hidden" name="is_global" value="2">


                <!-- <div class="layui-form-item">
                    <label class="layui-form-label">是否全局统计</label>
                    <div class="layui-input-block">
                        <input type="radio" name="is_global" value="1" title='是' <if condition="$list.is_global eq 1 OR empty($list)">checked</if>>
                        <input type="radio" name="is_global" value="2" title='否' <if condition="$list.is_global eq 2">checked</if>>
                    </div>
                </div> -->

                <div class="layui-form-item">
                    <label class="layui-form-label"></label>
                    <div class="layui-input-inline">
                        <input type="button" lay-submit id="transmit" lay-filter="LAY-user-back-submit" value="确认" class="layui-btn">
                        <button type="reset" class="layui-btn layui-btn-primary" onclick="javascript:history.go(-1)">返回</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    layui.use(['upload','form','formSelects','laydate'],function(){
        var upload = layui.upload;
        var form = layui.form;
        var laydate = layui.laydate;
        var formSelects = layui.formSelects;
        form.render();
        //封面上传
        upload.render({
            elem: '#test1',
            auto: false,
            field:'pic',
            //,multiple: true
            bindAction: '#test1s',
            done: function(res){
              console.log(res)
            }
        });

        form.on('select(goods)', function(data){
            if (!data.value){
                 $('.comp').css('display','none');
                 $('.ajax-service').children().remove();
                layer.msg('请选择门店');
                return false;
            }
             $.ajax({
                  type: "POST",
                  url: "{:url('Doctor/service')}",
                  dataType:"JSON",
                  data: {id:data.value},
                  success: function(data){

                    if (data.code == 200){
                        $('.comp').css('display','block');
                        $('.ajax-service').children().remove();
                        var service = '';
                        for (var k in data.data){
                            service +=  '<input type="checkbox" name="comp_id[]" title="'+data.data[k]['title']+'" value="'+data.data[k]['id']+'">';
                        }

                        $('.ajax-service').append(service);
                        form.render();
                    }else{
                        layer.msg('该门店暂无服务信息');
                    }
                  }
               });

        });


        //开始时间
        laydate.render({
            elem: '#start', //指定元素
            type:'date',
            done:function(value,date){
                end.config.min = {
                    year:date.year,
                    month:date.month-1, 
                    date: date.date,
                };
                if(value > $('#end').val()){
                    $('#end').val('');
                }
            }
        });
        var end = laydate.render({
            elem: '#end', //指定元素
            type:'date',
        });

    });

    //表单上传
    fromUpload('form',"{:url('Doctor/save')}");
</script>